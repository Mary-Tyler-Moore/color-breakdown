{"version":3,"file":"db-worker.js","sources":["../../node_modules/idb/lib/idb.js","../../node_modules/idb/lib/node.js","../../src/db-worker/db.ts","../../src/db-worker/data-uri.ts","../../src/db-worker/examples.ts","../../src/db-worker/history.ts","../../src/revoke-object-url.ts","../../src/db-worker/handle-message.ts","../../src/db-worker/index.ts"],"sourcesContent":["'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n","if (typeof indexedDB != 'undefined') {\n  module.exports = require('./idb.js');\n}\nelse {\n  module.exports = {\n    open: function () {\n      return Promise.reject('IDB requires a browser environment');\n    },\n    delete: function () {\n      return Promise.reject('IDB requires a browser environment');\n    }\n  };\n}\n","import idb from 'idb';\nimport { ColorPalette } from '../color-interfaces';\nimport { PaletteEntry } from '../entry';\nimport { dataUriToBlob } from './data-uri';\n\nexport interface HistoryEntry {\n    readonly id: number;\n    readonly imgSrc: string;\n    readonly colors: ColorPalette;\n    readonly name?: string;\n}\n\ninterface ExampleEntry {\n    id: number;\n    hidden: true;\n}\n\nconst dbPromise = idb.open('history-store', 2, upgradeDB => {\n    switch (upgradeDB.oldVersion) {\n        case 0:\n            upgradeDB.createObjectStore<HistoryEntry, number>('history', {\n                keyPath: 'id',\n            });\n        // fall through\n        case 1:\n            upgradeDB.createObjectStore<ExampleEntry, number>('example', {\n                keyPath: 'id',\n            });\n        // fall through\n    }\n});\n\nasync function open<T>(name: string, mode: 'readonly' | 'readwrite') {\n    const db = await dbPromise;\n    const tx = await db.transaction(name, mode);\n    const store = tx.objectStore<T, number>(name);\n\n    return { store, complete: tx.complete };\n}\n\n/**\n * Open the history object store.\n * @returns object with `store` property and inner promise `complete` which\n * resolves once the transaction is complete.\n */\nexport function openHistory(mode: 'readonly' | 'readwrite') {\n    return open<HistoryEntry>('history', mode);\n}\n\nexport function openExample(mode: 'readonly' | 'readwrite') {\n    return open<ExampleEntry>('example', mode);\n}\n\n/**\n * Open the history and example object stores.\n */\nexport async function openHistoryAndExample(mode: 'readonly' | 'readwrite') {\n    const db = await dbPromise;\n    const tx = await db.transaction(['history', 'example'], mode);\n\n    return {\n        history: tx.objectStore<HistoryEntry, number>('history'),\n        example: tx.objectStore<ExampleEntry, number>('example'),\n        complete: tx.complete,\n    };\n}\n\nexport function processEntry(entry: HistoryEntry): PaletteEntry;\nexport function processEntry(entry: null | undefined): null;\nexport function processEntry(\n    entry: HistoryEntry | null | undefined,\n): PaletteEntry | null {\n    if (entry == null) {\n        return null;\n    }\n    const timestamp = entry.id as number;\n    const imgBlob = dataUriToBlob(entry.imgSrc);\n    return {\n        timestamp,\n        imgSrc: URL.createObjectURL(imgBlob),\n        colors: entry.colors,\n        name: entry.name || new Date(timestamp).toLocaleString(),\n    };\n}\n","/**\n * Convert Data URI representing an image into a blob with the same data.\n * @see https://stackoverflow.com/questions/12168909/blob-from-dataurl\n */\nexport function dataUriToBlob(dataUri: string) {\n    const [header, data] = dataUri.split(',', 2);\n\n    // separate out the mime component\n    const mimeType = header.split(':', 2)[1].split(';', 1)[0];\n    // convert base64 to raw binary data held in a string\n    const byteString = atob(data);\n\n    // write the bytes of the string to an ArrayBuffer\n    const buffer = new ArrayBuffer(byteString.length);\n    const intBuffer = new Uint8Array(buffer); // create a view into the buffer\n    for (let i = 0; i < byteString.length; i++) {\n        intBuffer[i] = byteString.charCodeAt(i);\n    }\n\n    return new Blob([buffer], { type: mimeType });\n}\n\n/**\n * Convert blob to data uri\n * @throws DOMException if error when reading\n */\nexport function blobToDataUri(blob: Blob) {\n    return new Promise<string>((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = () => reject(reader.error);\n        reader.readAsDataURL(blob);\n    });\n}\n","import { PaletteEntry } from '../entry';\n\nconst white = '#FFFFFF';\nconst black = '#FFFFFF';\n\nconst example1: PaletteEntry = {\n    timestamp: 1,\n    imgSrc: 'img/demo/andrew-hughes-261571-unsplash.jpg',\n    name: 'Photo by Andrew Hughes on Unsplash',\n    colors: {\n        vibrant: { color: '#AE340E', textColor: white },\n        darkVibrant: { color: '#6C140C', textColor: white },\n        lightVibrant: { color: '#DACC9B', textColor: black },\n        muted: { color: '#9F805F', textColor: white },\n        darkMuted: { color: '#3B3945', textColor: white },\n        lightMuted: { color: '#DAD3B0', textColor: black },\n    },\n};\n\nconst example2: PaletteEntry = {\n    timestamp: 2,\n    imgSrc: 'img/demo/ever-wild-634729-unsplash.jpg',\n    name: 'Photo by ever wild on Unsplash',\n    colors: {\n        vibrant: { color: '#FBA409', textColor: black },\n        darkVibrant: { color: '#7C0404', textColor: white },\n        lightVibrant: { color: '#F9A250', textColor: black },\n        muted: { color: '#AC784C', textColor: white },\n        darkMuted: { color: '#8C6C44', textColor: white },\n        lightMuted: { color: '#BC987A', textColor: black },\n    },\n};\n\nconst example3: PaletteEntry = {\n    timestamp: 3,\n    imgSrc: 'img/demo/will-turner-1244879-unsplash.jpg',\n    name: 'Photo by Will Turner on Unsplash',\n    colors: {\n        vibrant: { color: '#1E8EE0', textColor: white },\n        darkVibrant: { color: '#061C2C', textColor: white },\n        lightVibrant: { color: '#8AC4EF', textColor: black },\n        muted: { color: '#777C80', textColor: white },\n        darkMuted: { color: '#253D4C', textColor: white },\n        lightMuted: { color: '#BBBCC4', textColor: black },\n    },\n};\n\nexport const examples: { [id: number]: PaletteEntry } = {\n    1: example1,\n    2: example2,\n    3: example3,\n};\n","import { PaletteEntry } from '../entry';\nimport { revokeIfObjectUrl } from '../revoke-object-url';\nimport { blobToDataUri } from './data-uri';\nimport {\n    HistoryEntry,\n    openExample,\n    openHistory,\n    openHistoryAndExample,\n    processEntry,\n} from './db';\nimport { examples } from './examples';\n\n/**\n * Loads a single history item for the main palette viewer\n */\nexport async function loadItemFromDB(\n    timestamp: number,\n): Promise<PaletteEntry | null> {\n    if (timestamp < 10) {\n        const { store } = await openExample('readonly');\n        const info = await store.get(timestamp);\n        const hidden = info != null ? info.hidden : false;\n        return hidden ? null : examples[timestamp] || null;\n    } else {\n        const { store } = await openHistory('readonly');\n        const item = await store.get(timestamp);\n        return processEntry(item);\n    }\n}\n\nexport async function openFirstItem(): Promise<PaletteEntry | null> {\n    const { history, example } = await openHistoryAndExample('readonly');\n    const historyItems = await history.getAll(undefined, 1);\n    if (historyItems.length > 0) {\n        return processEntry(historyItems[0]);\n    }\n\n    const hiddenExamples = new Set(\n        (await example.getAll())\n            .filter(item => item.hidden)\n            .map(item => item.id),\n    );\n    const visibleExample = Object.values(examples).find(\n        example => !hiddenExamples.has(example.timestamp),\n    );\n    return visibleExample || null;\n}\n\n/**\n * Delete a history item with the given timestamp\n */\nexport async function deleteItemFromDB(timestamp: number) {\n    if (timestamp < 10) {\n        const { store, complete } = await openExample('readwrite');\n        store.put({ id: timestamp, hidden: true });\n        await complete;\n    } else {\n        const { store, complete } = await openHistory('readwrite');\n        store.delete(timestamp);\n        await complete;\n    }\n}\n\n/**\n * Load the history list.\n * @param callback Called on each iteration.\n */\nexport async function loadHistoryFromDB(\n    exampleCb: (id: number) => void,\n    historyCb: (entry: PaletteEntry) => void,\n) {\n    const { history, example, complete } = await openHistoryAndExample(\n        'readonly',\n    );\n\n    example.iterateCursor(cursor => {\n        if (!cursor) return;\n        if (cursor.value.hidden) {\n            exampleCb(cursor.key as number);\n        }\n        cursor.continue();\n    });\n    history.iterateCursor(cursor => {\n        if (!cursor) return;\n        historyCb(processEntry(cursor.value));\n        cursor.continue();\n    });\n\n    await complete;\n}\n\n/**\n * Equivalent to `fetch(url).then(r => r.blob())`.\n * Firefox 64 crashes when fetching an object URL as a blob.\n * TODO: Replace once Firefox 65 is out.\n */\nfunction fetchBlob(url: string) {\n    return new Promise<Blob>((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'blob';\n        xhr.onload = function() {\n            if (this.status === 200) {\n                resolve(this.response);\n            } else {\n                reject(new Error(this.statusText));\n            }\n        };\n        xhr.onerror = function() {\n            reject(new Error(this.statusText));\n        };\n        xhr.send();\n    });\n}\n\n/**\n * Save items to the database.\n * Items may have object URLs as `imgSrc` properties, and will be processed\n * into data URIs.\n */\nexport async function saveItemsToDB(\n    items: PaletteEntry[],\n): Promise<HistoryEntry[]> {\n    // Need to process entries first due to IDB restrictions\n    const entries = await Promise.all(\n        items.map(async item => {\n            let blob: Blob;\n            try {\n                blob = await fetchBlob(item.imgSrc);\n            } catch (err) {\n                console.error(err);\n                throw err;\n            }\n            const dataUri = await blobToDataUri(blob);\n            revokeIfObjectUrl(item.imgSrc);\n            return {\n                id: item.timestamp,\n                imgSrc: dataUri,\n                colors: item.colors,\n                name: item.name,\n            };\n        }),\n    );\n\n    const { store, complete } = await openHistory('readwrite');\n    entries.forEach(entry => store.put(entry));\n    await complete;\n\n    return entries;\n}\n","/**\n * Revoke a url if it is an object url.\n */\nexport function revokeIfObjectUrl(url: string) {\n    if (new URL(url).protocol === 'blob:') {\n        URL.revokeObjectURL(url);\n    }\n}\n\n/**\n * When used as an `onload` listener for an image, this function will\n * revoke the image's source object url if it is an object url.\n */\nexport function revokeObjectUrlOnLoad(evt: Event) {\n    const img = evt.target as HTMLImageElement;\n    revokeIfObjectUrl(img.src);\n}\n","import { PaletteEntry } from '../entry';\nimport { UiAction } from '../page/handle-message';\nimport { HistoryEntry, processEntry } from './db';\nimport {\n    deleteItemFromDB,\n    loadHistoryFromDB,\n    loadItemFromDB,\n    openFirstItem,\n    saveItemsToDB,\n} from './history';\n\ninterface SaveAction {\n    type: 'SAVE';\n    payload: PaletteEntry[];\n}\n\ninterface LoadAction {\n    type: 'LOAD';\n    payload: null;\n}\n\ninterface OpenAction {\n    type: 'OPEN';\n    payload: {\n        timestamp: number;\n        firstLoad: boolean;\n    };\n}\n\ninterface DeleteAction {\n    type: 'DELETE';\n    payload: {\n        timestamp: number;\n        current: boolean;\n    };\n}\n\nexport type WorkerAction = SaveAction | LoadAction | OpenAction | DeleteAction;\ntype ProcessEntry = (entry: HistoryEntry) => PaletteEntry;\n\nexport async function handleMessage(\n    action: WorkerAction,\n    postMessage: (msg: UiAction) => void,\n) {\n    console.log(action.type, action.payload);\n    try {\n        switch (action.type) {\n            case 'SAVE':\n                if (action.payload.length > 0) {\n                    const entries = await saveItemsToDB(action.payload);\n                    postMessage({\n                        type: 'DISPLAY',\n                        payload: {\n                            entry: processEntry(entries[0]),\n                            firstLoad: false,\n                        },\n                    });\n                    postMessage({\n                        type: 'ADD',\n                        payload: entries.map(processEntry as ProcessEntry),\n                    });\n                }\n                return;\n            case 'LOAD':\n                await loadHistoryFromDB(\n                    id => postMessage({ type: 'REMOVE', payload: [id] }),\n                    entry => postMessage({ type: 'ADD', payload: [entry] }),\n                );\n                return;\n            case 'OPEN':\n                if (!Number.isNaN(action.payload.timestamp)) {\n                    const entry = await loadItemFromDB(\n                        action.payload.timestamp,\n                    );\n                    if (entry != null) {\n                        postMessage({\n                            type: 'DISPLAY',\n                            payload: {\n                                entry,\n                                firstLoad: action.payload.firstLoad,\n                            },\n                        });\n                    }\n                }\n                return;\n            case 'DELETE':\n                if (!Number.isNaN(action.payload.timestamp)) {\n                    await deleteItemFromDB(action.payload.timestamp);\n                    postMessage({\n                        type: 'REMOVE',\n                        payload: [action.payload.timestamp],\n                    });\n                    if (action.payload.current) {\n                        const otherEntry = await openFirstItem();\n                        postMessage({\n                            type: 'DISPLAY',\n                            payload: {\n                                entry: otherEntry,\n                                firstLoad: false,\n                            },\n                        });\n                    }\n                }\n                return;\n        }\n    } catch (err) {\n        postMessage({ type: 'ERROR', payload: String(err) });\n    }\n}\n","import { handleMessage } from './handle-message';\n\nexport declare var self: DedicatedWorkerGlobalScope;\n\nself.addEventListener('message', evt => handleMessage(evt.data, postMessage));\nhandleMessage({ type: 'LOAD', payload: null }, postMessage);\n"],"names":["promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","p","apply","then","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","prototype","get","this","set","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","value","Cursor","Index","index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","complete","oncomplete","onabort","UpgradeDB","db","oldVersion","transaction","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","objectStore","IDBTransaction","createObjectStore","IDBDatabase","funcName","replace","arr","Array","slice","call","callback","length","nativeObject","getAll","query","count","instance","items","iterateCursor","push","undefined","continue","exp","open","name","version","upgradeCallback","indexedDB","onupgradeneeded","event","delete","module","exports","require$$0","dbPromise","idb","upgradeDB","keyPath","async","mode","tx","openHistory","openExample","openHistoryAndExample","history","example","processEntry","entry","timestamp","id","imgBlob","dataUri","header","data","split","mimeType","byteString","atob","buffer","ArrayBuffer","intBuffer","Uint8Array","i","charCodeAt","Blob","type","dataUriToBlob","imgSrc","URL","createObjectURL","colors","Date","toLocaleString","white","black","examples","1","vibrant","color","textColor","darkVibrant","lightVibrant","muted","darkMuted","lightMuted","2","3","saveItemsToDB","entries","all","map","item","blob","url","xhr","XMLHttpRequest","responseType","onload","status","response","Error","statusText","send","fetchBlob","err","console","reader","FileReader","readAsDataURL","blobToDataUri","protocol","revokeObjectURL","revokeIfObjectUrl","put","handleMessage","action","postMessage","log","payload","firstLoad","exampleCb","historyCb","hidden","key","loadHistoryFromDB","Number","isNaN","info","loadItemFromDB","deleteItemFromDB","current","otherEntry","historyItems","hiddenExamples","Set","filter","values","find","has","openFirstItem","String","self","addEventListener","evt"],"mappings":"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"}