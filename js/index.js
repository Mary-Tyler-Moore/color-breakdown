function e(e){const t=e.target;var n;n=t.src,"blob:"===new URL(n).protocol&&URL.revokeObjectURL(n)}const t=navigator.clipboard||import("./chunk-76c6e771.js");function n(e){switch(e.colorTextType){case"RGB":case"HSL":const t=function(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return null===t?null:[t[1],t[2],t[3]].map(e=>parseInt(e,16))}(e.hexColor);if(null==t)return e.hexColor;const[n,a,o]=t;if("RGB"===e.colorTextType)return`R${n} G${a} B${o}`;const[r,l,c]=function(e,t,n){e/=255,t/=255,n/=255;let a,o,r=Math.max(e,t,n),l=Math.min(e,t,n),c=(r+l)/2;if(r===l)a=o=0;else{let s=r-l;switch(o=c>.5?s/(2-r-l):s/(r+l),r){case e:a=(t-n)/s+(t<n?6:0);break;case t:a=(n-e)/s+2;break;case n:a=(e-t)/s+4;break;default:throw new Error}a/=6}return[a,o,c]}(n,a,o).map(e=>Math.round(100*e));return`H${r} S${l} L${c}`;case"HEX":default:return e.hexColor}}function a(e,t){const a=null!=e.color,o=null!=e.colorTextType;if(t.hidden=!a,a){const{textColor:a,color:r}=e.color;t.style.backgroundColor=r,o&&(t.style.color=a,t.querySelector(".swatch-text").textContent=n({colorTextType:e.colorTextType,hexColor:r}))}}const o=Object.freeze({vibrant:"vibrant",darkVibrant:"dark-vibrant",lightVibrant:"light-vibrant",muted:"muted",darkMuted:"dark-muted",lightMuted:"light-muted"});function r(e,t){for(const[n,r]of Object.entries(o)){const o=t.querySelector(`.swatch.${r}`);a({colorTextType:e.colorTextType,color:null!=e.colors?e.colors[n]:null},o)}}function l(e,t){t.src=e.imgSrc,t.alt=e.name}const c=document.getElementById("grid-items"),s=document.getElementById("grid-item-template");const i=document.getElementById("palette"),d=i.querySelector("img.preview"),u=document.getElementById("color-display"),m=document.getElementById("back"),p="Color Breakdown";function y(){i.classList.remove("is-open"),history.replaceState(!1,p,"."),document.title=p}let f=null;function g(t){switch(console.log(t.type,t.payload),t.type){case"ADD":return void function(t){const n=document.createDocumentFragment();for(const a of t.items){const t=document.importNode(s.content,!0);l(a,t.querySelector("img.preview")),r(Object.assign({},a,{colorTextType:null}),t);const o=t.querySelector("a");o.id=a.timestamp.toString(),o.href=`#${a.timestamp}`,t.querySelector("img").addEventListener("load",e),n.appendChild(t)}c.appendChild(n)}({items:t.payload});case"REMOVE":return void{timestamps:t.payload}.timestamps.forEach(e=>{const t=document.getElementById(e.toString()),n=null!=t?t.parentElement:null;null!=n&&c.removeChild(n)});case"DISPLAY":return void function(e){if(f&&u.removeEventListener("change",f),e.firstLoad?m.dataset.firstload="firstload":delete m.dataset.firstload,null!=e.data){function t(){r(Object.assign({},e.data,{colorTextType:u.value}),i)}t(),l(e.data,d),u.addEventListener("change",t),f=t,i.classList.add("is-open");const n=`${e.data.name} | ${p}`;document.title=n,e.updateHash&&history.replaceState(!0,n,`#${e.data.timestamp}`)}else r({colors:null,colorTextType:u.value},i),l({imgSrc:"img/placeholder.svg",name:"No image"},d),f=null,y()}({data:t.payload.entry,firstLoad:t.payload.firstLoad,updateHash:t.payload.updateHash});case"ERROR":return void console.error(t.payload)}}const h=import("../lib/node-vibrant/vibrant.js");async function v({name:e,url:t}){const{default:n}=await h,a=await n.from(t).getPalette();function o(e){return e?{color:e.getHex(),textColor:e.getBodyTextColor()}:null}return{timestamp:Date.now(),colors:{vibrant:o(a.Vibrant),darkVibrant:o(a.DarkVibrant),lightVibrant:o(a.LightVibrant),muted:o(a.Muted),darkMuted:o(a.DarkMuted),lightMuted:o(a.LightMuted)},imgSrc:t,name:e}}const b=new Worker("js/db-worker.js");function E(e){b.postMessage(e)}const L=document.getElementById("new-palette-entry"),w=L.elements.namedItem("imagefile");async function x(){E({type:"SAVE",payload:await function(e){const t=Array.from(e||[]).filter(e=>null!=e.type.match(/^image\//)).map(e=>({name:e.name,url:URL.createObjectURL(e)}));return Promise.all(t.map(v))}(w.files)})}function k(e){E({type:"OPEN",payload:{timestamp:parseInt(location.hash.slice(1),10),firstLoad:e}})}k(!0),window.addEventListener("hashchange",()=>k(!1)),b.addEventListener("message",e=>g(e.data)),document.querySelector(".palette-image").addEventListener("load",e),document.getElementById("back").addEventListener("click",function(){m.dataset.firstload||history.back(),y()},{passive:!0}),document.getElementById("delete").addEventListener("click",()=>{E({type:"DELETE",payload:{timestamp:parseInt(location.hash.slice(1),10),current:!0}})},{passive:!0}),document.querySelector(".palette-colors").addEventListener("click",async function(e){const n=e.target.closest("button.swatch"),a=null!=n?n.querySelector(".swatch-text"):null,o=null!=a?a.textContent:null;if(o){const e=await t;await e.writeText(o)}},{passive:!0}),L.addEventListener("submit",e=>{e.preventDefault(),x()}),w.addEventListener("change",x,{passive:!0}),w.addEventListener("focus",()=>w.classList.add("focus"),{passive:!0}),w.addEventListener("blur",()=>w.classList.remove("focus"),{passive:!0});
//# sourceMappingURL=index.js.map
