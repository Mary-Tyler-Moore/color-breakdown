function t(t){const e=t.target;var a;a=e.src,"blob:"===new URL(a).protocol&&URL.revokeObjectURL(a)}const e=navigator.clipboard||import("./chunk-76c6e771.js");function a(t){switch(t.colorTextType){case"RGB":case"HSL":const e=function(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return null===e?null:[e[1],e[2],e[3]].map(t=>parseInt(t,16))}(t.hexColor);if(null==e)return t.hexColor;const[a,n,o]=e;if("RGB"===t.colorTextType)return`R${a} G${n} B${o}`;const[c,l,r]=function(t,e,a){t/=255,e/=255,a/=255;let n,o,c=Math.max(t,e,a),l=Math.min(t,e,a),r=(c+l)/2;if(c===l)n=o=0;else{let i=c-l;switch(o=r>.5?i/(2-c-l):i/(c+l),c){case t:n=(e-a)/i+(e<a?6:0);break;case e:n=(a-t)/i+2;break;case a:n=(t-e)/i+4;break;default:throw new Error}n/=6}return[n,o,r]}(a,n,o).map(t=>Math.round(100*t));return`H${c} S${l} L${r}`;case"HEX":default:return t.hexColor}}function n(t,e){const n=null!=t.color,o=null!=t.colorTextType;if(e.hidden=!n,n){const{textColor:n,color:c}=t.color;e.style.backgroundColor=c,o&&(e.style.color=n,e.querySelector(".swatch-text").textContent=a({colorTextType:t.colorTextType,hexColor:c}))}}const o=Object.freeze({vibrant:"vibrant",darkVibrant:"dark-vibrant",lightVibrant:"light-vibrant",muted:"muted",darkMuted:"dark-muted",lightMuted:"light-muted"});function c(t,e){for(const[a,c]of Object.entries(o)){const o=e.querySelector(`.swatch.${c}`);n({colorTextType:t.colorTextType,color:null!=t.colors?t.colors[a]:null},o)}}function l(t,e){e.src=t.imgSrc,e.alt=t.name}const r=document.getElementById("grid-items"),i=document.getElementById("grid-item-template");const s=document.getElementById("palette"),d=s.querySelector("img.preview"),u=document.getElementById("color-display"),m=document.getElementById("back"),y="Color Breakdown";function f(){s.classList.remove("is-open"),history.replaceState(!1,y,"."),document.title=y}let p=null;function g(e){switch(console.log(e.type,e.payload),e.type){case"ADD":return void function(e){const a=document.createDocumentFragment();for(const n of e.items){const e=document.importNode(i.content,!0);l(n,e.querySelector("img.preview")),c(Object.assign({},n,{colorTextType:null}),e);const o=e.querySelector("a");o.id=n.timestamp.toString(),o.href=`#${n.timestamp}`,e.querySelector("img").addEventListener("load",t),a.appendChild(e)}r.appendChild(a)}({items:e.payload});case"REMOVE":return void{timestamps:e.payload}.timestamps.forEach(t=>{const e=document.getElementById(t.toString()),a=null!=e?e.parentElement:null;null!=a&&r.removeChild(a)});case"DISPLAY":return void function(t){if(p&&u.removeEventListener("change",p),t.firstLoad?m.dataset.firstload="firstload":delete m.dataset.firstload,null!=t.data){function e(){c(Object.assign({},t.data,{colorTextType:u.value}),s)}e(),l(t.data,d),u.addEventListener("change",e),p=e,s.classList.add("is-open");const a=`${t.data.name} | ${y}`;document.title=a,t.updateHash&&history.replaceState(!0,a,`#${t.data.timestamp}`)}else c({colors:null,colorTextType:u.value},s),l({imgSrc:"img/placeholder.svg",name:"No image"},d),p=null,f()}({data:e.payload.entry,firstLoad:e.payload.firstLoad,updateHash:e.payload.updateHash});case"ERROR":return void console.error(e.payload)}}const h=import("../lib/node-vibrant/vibrant.js");async function v({name:t,url:e}){const{default:a}=await h,n=await a.from(e).getPalette();function o(t){return t?{color:t.getHex(),textColor:t.getBodyTextColor()}:null}return{timestamp:Date.now(),colors:{vibrant:o(n.Vibrant),darkVibrant:o(n.DarkVibrant),lightVibrant:o(n.LightVibrant),muted:o(n.Muted),darkMuted:o(n.DarkMuted),lightMuted:o(n.LightMuted)},imgSrc:e,name:t}}const b=new Worker("js/db-worker.js");function w(t){b.postMessage(t)}const x=document.getElementById("new-palette-entry"),k=x.elements.namedItem("imagefile");async function B(){w({type:"SAVE",payload:await function(t){const e=Array.from(t||[]).filter(t=>null!=t.type.match(/^image\//)).map(t=>({name:t.name,url:URL.createObjectURL(t)}));return Promise.all(e.map(v))}(k.files)})}function S(t){w({type:"OPEN",payload:{timestamp:parseInt(location.hash.slice(1),10),firstLoad:t}})}S(!0),window.addEventListener("hashchange",()=>S(!1)),b.addEventListener("message",t=>g(t.data)),document.querySelector(".palette-image").addEventListener("load",t),document.getElementById("back").addEventListener("click",function(){m.dataset.firstload||history.back(),f()},{passive:!0}),document.getElementById("delete").addEventListener("click",()=>{w({type:"DELETE",payload:{timestamp:parseInt(location.hash.slice(1),10),current:!0}})},{passive:!0}),document.querySelector(".palette-colors").addEventListener("click",async function(t){const a=t.target.closest("button.swatch"),n=null!=a?a.querySelector(".swatch-text"):null,o=null!=n?n.textContent:null;if(o){const t=await e;await t.writeText(o)}},{passive:!0}),x.addEventListener("submit",t=>{t.preventDefault(),B()}),k.addEventListener("change",B,{passive:!0}),k.addEventListener("focus",()=>k.classList.add("focus"),{passive:!0}),k.addEventListener("blur",()=>k.classList.remove("focus"),{passive:!0});
//# sourceMappingURL=index.js.map
