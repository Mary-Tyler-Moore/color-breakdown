function e(e){const t=e.target;var o;o=t.src,"blob:"===new URL(o).protocol&&URL.revokeObjectURL(o)}const t=navigator.clipboard||import("./chunk-b051499f.js");function o(e){switch(e.colorTextType){case"RGB":case"HSL":const t=function(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return null==t?null:[t[1],t[2],t[3]].map(e=>parseInt(e,16))}(e.hexColor);if(null==t)return e.hexColor;const[o,a,n]=t;if("RGB"===e.colorTextType)return`R${o} G${a} B${n}`;const[r,c,l]=function(e,t,o){e/=255,t/=255,o/=255;let a,n,r=Math.max(e,t,o),c=Math.min(e,t,o),l=(r+c)/2;if(r===c)a=n=0;else{let s=r-c;switch(n=l>.5?s/(2-r-c):s/(r+c),r){case e:a=(t-o)/s+(t<o?6:0);break;case t:a=(o-e)/s+2;break;case o:a=(e-t)/s+4;break;default:throw new Error}a/=6}return[a,n,l]}(o,a,n).map(e=>Math.round(100*e));return`H${r} S${c} L${l}`;case"HEX":default:return e.hexColor}}function a(e,t){const a=null!=e.color,n=null!=e.colorTextType;if(t.hidden=!a,a){const{textColor:a,color:r}=e.color;t.style.backgroundColor=r,n&&(t.style.color=a,t.querySelector(".swatch-text").textContent=o({colorTextType:e.colorTextType,hexColor:r}))}}const n=new Map(Object.entries({vibrant:"vibrant",darkVibrant:"dark-vibrant",lightVibrant:"light-vibrant",muted:"muted",darkMuted:"dark-muted",lightMuted:"light-muted"}));function r(e,t){const{colors:o,colorTextType:r}=e;for(const[e,c]of n){const n=t.querySelector(`.swatch.${c}`);a({colorTextType:r,color:null!=o?o[e]:null},n)}}function c(e,t){t.src=e.imgSrc,t.alt=e.name}const l=document.querySelector("#grid-items"),s=document.querySelector("#grid-item-template");const i=document.querySelector("#back");const d=document.querySelector("#palette"),u=d.querySelector("img.preview"),m=document.querySelector("#color-display"),p="Color Breakdown";function f(){d.classList.remove("is-open"),history.replaceState(!1,p,"."),document.title=p}let y=null;function h(e){y&&m.removeEventListener("change",y);const t=m.value;if(function(e){e.firstLoad?i.dataset.firstload="firstload":delete i.dataset.firstload}(e),null!=e.data){function o(){r({...e.data,colorTextType:t},d)}o(),c(e.data,u),m.addEventListener("change",o),y=o,d.classList.add("is-open");const a=`${e.data.name} | ${p}`;document.title=a,e.updateHash&&history.replaceState(!0,a,`#${e.data.timestamp}`)}else r({colors:null,colorTextType:t},d),c({imgSrc:"img/placeholder.svg",name:"No image"},u),y=null,f()}function v(t){switch(console.log(t.type,t.payload),t.type){case"ADD":return void function(t){const o=document.createDocumentFragment();for(const a of t.items){const t=document.importNode(s.content,!0);c(a,t.querySelector("img.preview")),r({...a,colorTextType:null},t);const n=t.querySelector("a");n.id=a.timestamp.toString(),n.href=`#${a.timestamp}`,t.querySelector("img").addEventListener("load",e),o.appendChild(t)}l.appendChild(o)}({items:t.payload});case"REMOVE":return void{timestamps:t.payload}.timestamps.forEach(e=>{const t=document.querySelector(`#${e}`),o=null!=t?t.parentElement:null;null!=o&&l.removeChild(o)});case"DISPLAY":return void h({data:t.payload.entry,firstLoad:t.payload.firstLoad,updateHash:t.payload.updateHash});case"ERROR":return void console.error(t.payload)}}const g=import("../lib/node-vibrant/vibrant.js");async function b({name:e,url:t}){const{default:o}=await g,a=await o.from(t).getPalette();function n(e){return e?{color:e.getHex(),textColor:e.getBodyTextColor()}:null}return{timestamp:Date.now(),colors:{vibrant:n(a.Vibrant),darkVibrant:n(a.DarkVibrant),lightVibrant:n(a.LightVibrant),muted:n(a.Muted),darkMuted:n(a.DarkMuted),lightMuted:n(a.LightMuted)},imgSrc:t,name:e}}const L=new Worker("js/db-worker.js");function S(e){L.postMessage(e)}const w=document.querySelector("#new-palette-entry"),x=w.elements.namedItem("imagefile");async function E(){S({type:"SAVE",payload:await function(e){const t=Array.from(e||[]).filter(e=>null!=e.type.match(/^image\//)).map(e=>({name:e.name,url:URL.createObjectURL(e)}));return Promise.all(t.map(b))}(x.files)})}function k(e){S({type:"OPEN",payload:{timestamp:parseInt(location.hash.slice(1),10),firstLoad:e}})}k(!0),window.addEventListener("hashchange",()=>k(!1)),L.addEventListener("message",e=>v(e.data)),document.querySelector(".palette-image").addEventListener("load",e),document.querySelector("#back").addEventListener("click",function(){i.dataset.firstload||history.back(),f()},{passive:!0}),document.querySelector("#delete").addEventListener("click",()=>{S({type:"DELETE",payload:{timestamp:parseInt(location.hash.slice(1),10),current:!0}})},{passive:!0}),document.querySelector(".palette-colors").addEventListener("click",async function(e){const o=e.target.closest("button.swatch"),a=null!=o?o.querySelector(".swatch-text"):null,n=null!=a?a.textContent:null;if(n){const e=await t;await e.writeText(n)}},{passive:!0}),w.addEventListener("submit",e=>{e.preventDefault(),E()}),x.addEventListener("change",E,{passive:!0}),x.addEventListener("focus",()=>x.classList.add("focus"),{passive:!0}),x.addEventListener("blur",()=>x.classList.remove("focus"),{passive:!0});
//# sourceMappingURL=index.js.map
