function revokeIfObjectUrl(e){"blob:"===new URL(e).protocol&&URL.revokeObjectURL(e)}function revokeObjectUrlOnLoad(e){revokeIfObjectUrl(e.target.src)}const ClipboardModule=navigator.clipboard||import("./chunk-0e059a95.js");async function copySwatchText(e){const t=e.target.closest("button.swatch"),o=null!=t?t.querySelector(".swatch-text"):null,a=null!=o?o.textContent:null;if(a){const e=await ClipboardModule;await e.writeText(a)}}function hexToRgb(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return null===t?null:[t[1],t[2],t[3]].map(e=>parseInt(e,16))}function rgbToHsl(e,t,o){e/=255,t/=255,o/=255;let a,n,r=Math.max(e,t,o),l=Math.min(e,t,o),c=(r+l)/2;if(r===l)a=n=0;else{let s=r-l;switch(n=c>.5?s/(2-r-l):s/(r+l),r){case e:a=(t-o)/s+(t<o?6:0);break;case t:a=(o-e)/s+2;break;case o:a=(e-t)/s+4;break;default:throw new Error}a/=6}return[a,n,c]}function renderColorText(e){switch(e.colorTextType){case"RGB":case"HSL":const t=hexToRgb(e.hexColor);if(null==t)return e.hexColor;const[o,a,n]=t;if("RGB"===e.colorTextType)return`R${o} G${a} B${n}`;const[r,l,c]=rgbToHsl(o,a,n).map(e=>Math.round(100*e));return`H${r} S${l} L${c}`;case"HEX":default:return e.hexColor}}function renderSwatch(e,t){const o=null!=e.color,a=null!=e.colorTextType;if(t.hidden=!o,o){const{textColor:o,color:n}=e.color;t.style.backgroundColor=n,a&&(t.style.color=o,t.querySelector(".swatch-text").textContent=renderColorText({colorTextType:e.colorTextType,hexColor:n}))}}const colorClasses=Object.freeze({vibrant:"vibrant",darkVibrant:"dark-vibrant",lightVibrant:"light-vibrant",muted:"muted",darkMuted:"dark-muted",lightMuted:"light-muted"});function renderPalette(e,t){for(const[o,a]of Object.entries(colorClasses)){const n=t.querySelector(`.swatch.${a}`);renderSwatch({colorTextType:e.colorTextType,color:null!=e.colors?e.colors[o]:null},n)}}function renderImage(e,t){t.src=e.imgSrc,null!=e.alt?t.alt=e.alt:null!=e.timestamp?t.alt=new Date(e.timestamp).toLocaleString():t.alt=""}const LIST_ELEMENT=document.getElementById("grid-items"),LIST_ITEM_TEMPLATE=document.getElementById("grid-item-template");function addPalettesToList(e){const t=document.createDocumentFragment();for(const o of e.items){const e=document.importNode(LIST_ITEM_TEMPLATE.content,!0);renderImage(o,e.querySelector("img.preview")),renderPalette(Object.assign({},o,{colorTextType:null}),e);const a=e.querySelector("a");a.id=o.timestamp.toString(),a.href=`#${o.timestamp}`,e.querySelector("img").addEventListener("load",revokeObjectUrlOnLoad),t.appendChild(e)}LIST_ELEMENT.appendChild(t)}function deletePalettesFromList(e){e.timestamps.forEach(e=>{const t=document.getElementById(e.toString()),o=null!=t?t.parentElement:null;null!=o&&LIST_ELEMENT.removeChild(o)})}const MAIN_PALETTE_ELEMENT=document.getElementById("palette"),MAIN_PALETTE_IMAGE=MAIN_PALETTE_ELEMENT.querySelector("img.preview"),COLOR_DISPLAY_SELECT=document.getElementById("color-display"),LARGE_SCREEN=matchMedia("(min-width: 700px)"),TITLE="Color Breakdown",historyStack=[];function toHome(){historyStack.length>0&&history.back(),history.replaceState(!1,TITLE,".")}let listener=null;function displayMainPalette(e){if(listener&&COLOR_DISPLAY_SELECT.removeEventListener("change",listener),null!=e.data){function t(){renderPalette(Object.assign({},e.data,{colorTextType:COLOR_DISPLAY_SELECT.value}),MAIN_PALETTE_ELEMENT)}t(),renderImage(e.data,MAIN_PALETTE_IMAGE),COLOR_DISPLAY_SELECT.addEventListener("change",t),listener=t,MAIN_PALETTE_ELEMENT.classList.add("is-open");const{timestamp:o}=e.data;LARGE_SCREEN.matches?history.replaceState(!0,TITLE,`#${o}`):(history.pushState(!0,TITLE,`#${o}`),historyStack.push(o))}else renderPalette({colors:null,colorTextType:COLOR_DISPLAY_SELECT.value},MAIN_PALETTE_ELEMENT),renderImage({imgSrc:"img/placeholder.svg",alt:"No image"},MAIN_PALETTE_IMAGE),listener=null,MAIN_PALETTE_ELEMENT.classList.remove("is-open"),toHome()}function handleBackClick(e){e.preventDefault(),MAIN_PALETTE_ELEMENT.classList.remove("is-open"),toHome()}function handleMessage(e){switch(console.log(e.type,e.payload),e.type){case"ADD":return void addPalettesToList({items:e.payload});case"REMOVE":return void deletePalettesFromList({timestamps:e.payload});case"DISPLAY":return void displayMainPalette({data:e.payload});case"ERROR":return void console.error(e.payload)}}const VibrantModule=import("../lib/node-vibrant/vibrant.js");async function dataFromImageUrl(e){const{default:t}=await VibrantModule,o=await t.from(e).getPalette();function a(e){return e?{color:e.getHex(),textColor:e.getBodyTextColor()}:null}return{timestamp:Date.now(),colors:{vibrant:a(o.Vibrant),darkVibrant:a(o.DarkVibrant),lightVibrant:a(o.LightVibrant),muted:a(o.Muted),darkMuted:a(o.DarkMuted),lightMuted:a(o.LightMuted)},imgSrc:e}}function paletteFromImages(e){const t=Array.from(e||[]).filter(e=>null!=e.type.match(/^image\//)).map(e=>URL.createObjectURL(e));return Promise.all(t.map(dataFromImageUrl))}const dbWorker=new Worker("js/db-worker.js");function postMessage(e){dbWorker.postMessage(e)}const form=document.getElementById("new-palette-entry"),fileInput=form.elements.namedItem("imagefile");async function saveImages(){postMessage({type:"SAVE",payload:await paletteFromImages(fileInput.files)})}function loadFromHash(){postMessage({type:"OPEN",payload:parseInt(location.hash.slice(1),10)})}loadFromHash(),window.addEventListener("hashchange",loadFromHash),dbWorker.addEventListener("message",e=>handleMessage(e.data)),document.querySelector(".palette-image").addEventListener("load",revokeObjectUrlOnLoad),document.getElementById("back").addEventListener("click",handleBackClick),document.getElementById("delete").addEventListener("click",e=>{e.preventDefault(),postMessage({type:"DELETE",payload:{timestamp:parseInt(location.hash.slice(1),10),current:!0}})}),document.querySelector(".palette-colors").addEventListener("click",copySwatchText),form.addEventListener("submit",e=>{e.preventDefault(),saveImages()}),fileInput.addEventListener("change",saveImages),fileInput.addEventListener("focus",()=>fileInput.classList.add("focus")),fileInput.addEventListener("blur",()=>fileInput.classList.remove("focus"));
//# sourceMappingURL=index.js.map
