function revokeIfObjectUrl(e){"blob:"===new URL(e).protocol&&URL.revokeObjectURL(e)}function revokeObjectUrlOnLoad(e){revokeIfObjectUrl(e.target.src)}const ClipboardModule=navigator.clipboard||import("./chunk-76c6e771.js");async function copySwatchText(e){const t=e.target.closest("button.swatch"),a=null!=t?t.querySelector(".swatch-text"):null,o=null!=a?a.textContent:null;if(o){const e=await ClipboardModule;await e.writeText(o)}}function hexToRgb(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return null===t?null:[t[1],t[2],t[3]].map(e=>parseInt(e,16))}function rgbToHsl(e,t,a){e/=255,t/=255,a/=255;let o,n,r=Math.max(e,t,a),l=Math.min(e,t,a),s=(r+l)/2;if(r===l)o=n=0;else{let c=r-l;switch(n=s>.5?c/(2-r-l):c/(r+l),r){case e:o=(t-a)/c+(t<a?6:0);break;case t:o=(a-e)/c+2;break;case a:o=(e-t)/c+4;break;default:throw new Error}o/=6}return[o,n,s]}function renderColorText(e){switch(e.colorTextType){case"RGB":case"HSL":const t=hexToRgb(e.hexColor);if(null==t)return e.hexColor;const[a,o,n]=t;if("RGB"===e.colorTextType)return`R${a} G${o} B${n}`;const[r,l,s]=rgbToHsl(a,o,n).map(e=>Math.round(100*e));return`H${r} S${l} L${s}`;case"HEX":default:return e.hexColor}}function renderSwatch(e,t){const a=null!=e.color,o=null!=e.colorTextType;if(t.hidden=!a,a){const{textColor:a,color:n}=e.color;t.style.backgroundColor=n,o&&(t.style.color=a,t.querySelector(".swatch-text").textContent=renderColorText({colorTextType:e.colorTextType,hexColor:n}))}}const colorClasses=Object.freeze({vibrant:"vibrant",darkVibrant:"dark-vibrant",lightVibrant:"light-vibrant",muted:"muted",darkMuted:"dark-muted",lightMuted:"light-muted"});function renderPalette(e,t){for(const[a,o]of Object.entries(colorClasses)){const n=t.querySelector(`.swatch.${o}`);renderSwatch({colorTextType:e.colorTextType,color:null!=e.colors?e.colors[a]:null},n)}}function renderImage(e,t){t.src=e.imgSrc,t.alt=e.name}const LIST_ELEMENT=document.getElementById("grid-items"),LIST_ITEM_TEMPLATE=document.getElementById("grid-item-template");function addPalettesToList(e){const t=document.createDocumentFragment();for(const a of e.items){const e=document.importNode(LIST_ITEM_TEMPLATE.content,!0);renderImage(a,e.querySelector("img.preview")),renderPalette(Object.assign({},a,{colorTextType:null}),e);const o=e.querySelector("a");o.id=a.timestamp.toString(),o.href=`#${a.timestamp}`,e.querySelector("img").addEventListener("load",revokeObjectUrlOnLoad),t.appendChild(e)}LIST_ELEMENT.appendChild(t)}function deletePalettesFromList(e){e.timestamps.forEach(e=>{const t=document.getElementById(e.toString()),a=null!=t?t.parentElement:null;null!=a&&LIST_ELEMENT.removeChild(a)})}const MAIN_PALETTE_ELEMENT=document.getElementById("palette"),MAIN_PALETTE_IMAGE=MAIN_PALETTE_ELEMENT.querySelector("img.preview"),COLOR_DISPLAY_SELECT=document.getElementById("color-display"),BACK_BUTTON=document.getElementById("back"),TITLE="Color Breakdown";function closeMainPalette(){MAIN_PALETTE_ELEMENT.classList.remove("is-open"),history.replaceState(!1,TITLE,"."),document.title=TITLE}let listener=null;function displayMainPalette(e){if(listener&&COLOR_DISPLAY_SELECT.removeEventListener("change",listener),e.firstLoad?BACK_BUTTON.dataset.firstload="firstload":delete BACK_BUTTON.dataset.firstload,null!=e.data){function t(){renderPalette(Object.assign({},e.data,{colorTextType:COLOR_DISPLAY_SELECT.value}),MAIN_PALETTE_ELEMENT)}t(),renderImage(e.data,MAIN_PALETTE_IMAGE),COLOR_DISPLAY_SELECT.addEventListener("change",t),listener=t,MAIN_PALETTE_ELEMENT.classList.add("is-open");const a=`${e.data.name} | ${TITLE}`;document.title=a,e.updateHash&&history.replaceState(!0,a,`#${e.data.timestamp}`)}else renderPalette({colors:null,colorTextType:COLOR_DISPLAY_SELECT.value},MAIN_PALETTE_ELEMENT),renderImage({imgSrc:"img/placeholder.svg",name:"No image"},MAIN_PALETTE_IMAGE),listener=null,closeMainPalette()}function handleBackButton(){BACK_BUTTON.dataset.firstload||history.back(),closeMainPalette()}function handleMessage(e){switch(console.log(e.type,e.payload),e.type){case"ADD":return void addPalettesToList({items:e.payload});case"REMOVE":return void deletePalettesFromList({timestamps:e.payload});case"DISPLAY":return void displayMainPalette({data:e.payload.entry,firstLoad:e.payload.firstLoad,updateHash:e.payload.updateHash});case"ERROR":return void console.error(e.payload)}}const VibrantModule=import("../lib/node-vibrant/vibrant.js");async function dataFromImageUrl({name:e,url:t}){const{default:a}=await VibrantModule,o=await a.from(t).getPalette();function n(e){return e?{color:e.getHex(),textColor:e.getBodyTextColor()}:null}return{timestamp:Date.now(),colors:{vibrant:n(o.Vibrant),darkVibrant:n(o.DarkVibrant),lightVibrant:n(o.LightVibrant),muted:n(o.Muted),darkMuted:n(o.DarkMuted),lightMuted:n(o.LightMuted)},imgSrc:t,name:e}}function paletteFromImages(e){const t=Array.from(e||[]).filter(e=>null!=e.type.match(/^image\//)).map(e=>({name:e.name,url:URL.createObjectURL(e)}));return Promise.all(t.map(dataFromImageUrl))}const dbWorker=new Worker("js/db-worker.js");function postMessage(e){dbWorker.postMessage(e)}const form=document.getElementById("new-palette-entry"),fileInput=form.elements.namedItem("imagefile");async function saveImages(){postMessage({type:"SAVE",payload:await paletteFromImages(fileInput.files)})}function loadFromHash(e){postMessage({type:"OPEN",payload:{timestamp:parseInt(location.hash.slice(1),10),firstLoad:e}})}loadFromHash(!0),window.addEventListener("hashchange",()=>loadFromHash(!1)),dbWorker.addEventListener("message",e=>handleMessage(e.data)),document.querySelector(".palette-image").addEventListener("load",revokeObjectUrlOnLoad),document.getElementById("back").addEventListener("click",handleBackButton,{passive:!0}),document.getElementById("delete").addEventListener("click",()=>{postMessage({type:"DELETE",payload:{timestamp:parseInt(location.hash.slice(1),10),current:!0}})},{passive:!0}),document.querySelector(".palette-colors").addEventListener("click",copySwatchText,{passive:!0}),form.addEventListener("submit",e=>{e.preventDefault(),saveImages()}),fileInput.addEventListener("change",saveImages,{passive:!0}),fileInput.addEventListener("focus",()=>fileInput.classList.add("focus"),{passive:!0}),fileInput.addEventListener("blur",()=>fileInput.classList.remove("focus"),{passive:!0});
//# sourceMappingURL=index.js.map
