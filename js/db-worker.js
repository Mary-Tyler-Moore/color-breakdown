function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(t){!function(){function e(t){return new Promise(function(e,o){t.onsuccess=function(){e(t.result)},t.onerror=function(){o(t.error)}})}function o(t,o,r){var n,a=new Promise(function(a,i){e(n=t[o].apply(t,r)).then(a,i)});return a.request=n,a}function r(t,e,o){o.forEach(function(o){Object.defineProperty(t.prototype,o,{get:function(){return this[e][o]},set:function(t){this[e][o]=t}})})}function n(t,e,r,n){n.forEach(function(n){n in r.prototype&&(t.prototype[n]=function(){return o(this[e],n,arguments)})})}function a(t,e,o,r){r.forEach(function(r){r in o.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function i(t,e,r,n){n.forEach(function(n){n in r.prototype&&(t.prototype[n]=function(){return t=this[e],(r=o(t,n,arguments)).then(function(t){if(t)return new c(t,r.request)});var t,r})})}function s(t){this._index=t}function c(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function l(t){this._tx=t,this.complete=new Promise(function(e,o){t.oncomplete=function(){e()},t.onerror=function(){o(t.error)},t.onabort=function(){o(t.error)}})}function p(t,e,o){this._db=t,this.oldVersion=e,this.transaction=new l(o)}function d(t){this._db=t}r(s,"_index",["name","keyPath","multiEntry","unique"]),n(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(c,"_cursor",["direction","key","primaryKey","value"]),n(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var o=this,r=arguments;return Promise.resolve().then(function(){return o._cursor[t].apply(o._cursor,r),e(o._request).then(function(t){if(t)return new c(t,o._request)})})})}),u.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},r(u,"_store",["name","keyPath","indexNames","autoIncrement"]),n(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(u,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},r(l,"_tx",["objectStoreNames","mode"]),a(l,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},r(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},r(d,"_db",["name","version","objectStoreNames"]),a(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[u,s].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,o=(e=arguments,Array.prototype.slice.call(e)),r=o[o.length-1],n=this._store||this._index,a=n[t].apply(n,o.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[s,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var o=this,r=[];return new Promise(function(n){o.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():n(r)):n(r)})})})});var y={open:function(t,e,r){var n=o(indexedDB,"open",[t,e]),a=n.request;return a&&(a.onupgradeneeded=function(t){r&&r(new p(a.result,t.oldVersion,a.transaction))}),n.then(function(t){return new d(t)})},delete:function(t){return o(indexedDB,"deleteDatabase",[t])}};t.exports=y,t.exports.default=t.exports}()}),o=t(function(t){"undefined"!=typeof indexedDB?t.exports=e:t.exports={open:function(){return Promise.reject("IDB requires a browser environment")},delete:function(){return Promise.reject("IDB requires a browser environment")}}});o.open;const r=o.open("history-store",2,t=>{switch(t.oldVersion){case 0:t.createObjectStore("history",{keyPath:"id"});case 1:t.createObjectStore("example",{keyPath:"id"})}});async function n(t,e){const o=await r,n=await o.transaction(t,e);return{store:n.objectStore(t),complete:n.complete}}function a(t){return n("history",t)}function i(t){return n("example",t)}async function s(t){const e=await r,o=await e.transaction(["history","example"],t);return{history:o.objectStore("history"),example:o.objectStore("example"),complete:o.complete}}function c(t){if(null==t)return null;const e=t.id,o=function(t){const[e,o]=t.split(",",2),r=e.split(":",2)[1].split(";",1)[0],n=atob(o),a=new ArrayBuffer(n.length),i=new Uint8Array(a);for(let t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return new Blob([a],{type:r})}(t.imgSrc);return{timestamp:e,imgSrc:URL.createObjectURL(o),colors:t.colors,name:t.name||new Date(e).toLocaleString()}}const u="#FFFFFF",l="#FFFFFF",p={1:{timestamp:1,imgSrc:"img/demo/andrew-hughes-261571-unsplash.jpg",name:"Photo by Andrew Hughes on Unsplash",colors:{vibrant:{color:"#AE340E",textColor:u},darkVibrant:{color:"#6C140C",textColor:u},lightVibrant:{color:"#DACC9B",textColor:l},muted:{color:"#9F805F",textColor:u},darkMuted:{color:"#3B3945",textColor:u},lightMuted:{color:"#DAD3B0",textColor:l}}},2:{timestamp:2,imgSrc:"img/demo/ever-wild-634729-unsplash.jpg",name:"Photo by ever wild on Unsplash",colors:{vibrant:{color:"#FBA409",textColor:l},darkVibrant:{color:"#7C0404",textColor:u},lightVibrant:{color:"#F9A250",textColor:l},muted:{color:"#AC784C",textColor:u},darkMuted:{color:"#8C6C44",textColor:u},lightMuted:{color:"#BC987A",textColor:l}}},3:{timestamp:3,imgSrc:"img/demo/will-turner-1244879-unsplash.jpg",name:"Photo by Will Turner on Unsplash",colors:{vibrant:{color:"#1E8EE0",textColor:u},darkVibrant:{color:"#061C2C",textColor:u},lightVibrant:{color:"#8AC4EF",textColor:l},muted:{color:"#777C80",textColor:u},darkMuted:{color:"#253D4C",textColor:u},lightMuted:{color:"#BBBCC4",textColor:l}}}};async function d(t){const e=await Promise.all(t.map(async t=>{const e=await function(t){return new Promise((e,o)=>{const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){200===this.status?e(this.response):o(new Error(this.statusText))},r.onerror=function(){o(new Error(this.statusText))},r.send()})}(t.imgSrc),o=await function(t){return new Promise((e,o)=>{const r=new FileReader;r.onload=(()=>e(r.result)),r.onerror=(()=>o(r.error)),r.readAsDataURL(t)})}(e);return function(t){"blob:"===new URL(t).protocol&&URL.revokeObjectURL(t)}(t.imgSrc),{id:t.timestamp,imgSrc:o,colors:t.colors,name:t.name}})),{store:o,complete:r}=await a("readwrite");return e.forEach(t=>o.put(t)),await r,e}async function y(t,e){console.log(t.type,t.payload);try{switch(t.type){case"SAVE":if(t.payload.length>0){const o=await d(t.payload);e({type:"DISPLAY",payload:{entry:c(o[0]),firstLoad:!1,updateHash:!0}}),e({type:"ADD",payload:o.map(c)})}return;case"LOAD":return void await async function(t,e){const{history:o,example:r,complete:n}=await s("readonly");r.iterateCursor(e=>{e&&(e.value.hidden&&t(e.key),e.continue())}),o.iterateCursor(t=>{t&&(e(c(t.value)),t.continue())}),await n}(t=>e({type:"REMOVE",payload:[t]}),t=>e({type:"ADD",payload:[t]}));case"OPEN":let o=null;return Number.isNaN(t.payload.timestamp)||(o=await async function(t){if(t<10){const{store:e}=await i("readonly"),o=await e.get(t);return null!=o&&o.hidden?null:p[t]||null}{const{store:e}=await a("readonly");return c(await e.get(t))}}(t.payload.timestamp)),void e({type:"DISPLAY",payload:{entry:o,firstLoad:t.payload.firstLoad,updateHash:!1}});case"DELETE":if(!Number.isNaN(t.payload.timestamp)&&(await async function(t){if(t<10){const{store:e,complete:o}=await i("readwrite");e.put({id:t,hidden:!0}),await o}else{const{store:e,complete:o}=await a("readwrite");e.delete(t),await o}}(t.payload.timestamp),e({type:"REMOVE",payload:[t.payload.timestamp]}),t.payload.current)){const t=await async function(){const{history:t,example:e}=await s("readonly"),o=await t.getAll(void 0,1);if(o.length>0)return c(o[0]);const r=new Set((await e.getAll()).filter(t=>t.hidden).map(t=>t.id));return Object.values(p).find(t=>!r.has(t.timestamp))||null}();e({type:"DISPLAY",payload:{entry:t,firstLoad:!1,updateHash:!0}})}return}}catch(t){e({type:"ERROR",payload:String(t)})}}self.addEventListener("message",t=>y(t.data,postMessage)),y({type:"LOAD",payload:null},postMessage);
//# sourceMappingURL=db-worker.js.map
