function t(t){return new Promise(function(e,o){t.onsuccess=function(){e(t.result)},t.onerror=function(){o(t.error)}})}function e(e,o,r){var n,a=new Promise(function(a,i){t(n=e[o].apply(e,r)).then(a,i)});return a.request=n,a}function o(t,e,o){o.forEach(function(o){Object.defineProperty(t.prototype,o,{get:function(){return this[e][o]},set:function(t){this[e][o]=t}})})}function r(t,o,r,n){n.forEach(function(n){n in r.prototype&&(t.prototype[n]=function(){return e(this[o],n,arguments)})})}function n(t,e,o,r){r.forEach(function(r){r in o.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function a(t,o,r,n){n.forEach(function(n){n in r.prototype&&(t.prototype[n]=function(){return t=this[o],(r=e(t,n,arguments)).then(function(t){if(t)return new s(t,r.request)});var t,r})})}function i(t){this._index=t}function s(t,e){this._cursor=t,this._request=e}function c(t){this._store=t}function l(t){this._tx=t,this.complete=new Promise(function(e,o){t.oncomplete=function(){e()},t.onerror=function(){o(t.error)},t.onabort=function(){o(t.error)}})}function u(t,e,o){this._db=t,this.oldVersion=e,this.transaction=new l(o)}function p(t){this._db=t}o(i,"_index",["name","keyPath","multiEntry","unique"]),r(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(s,"_cursor",["direction","key","primaryKey","value"]),r(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(s.prototype[e]=function(){var o=this,r=arguments;return Promise.resolve().then(function(){return o._cursor[e].apply(o._cursor,r),t(o._request).then(function(t){if(t)return new s(t,o._request)})})})}),c.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},o(c,"_store",["name","keyPath","indexNames","autoIncrement"]),r(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(c,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},o(l,"_tx",["objectStoreNames","mode"]),n(l,"_tx",IDBTransaction,["abort"]),u.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},o(u,"_db",["name","version","objectStoreNames"]),n(u,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},o(p,"_db",["name","version","objectStoreNames"]),n(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[c,i].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,o=(e=arguments,Array.prototype.slice.call(e)),r=o[o.length-1],n=this._store||this._index,a=n[t].apply(n,o.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[i,c].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var o=this,r=[];return new Promise(function(n){o.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():n(r)):n(r)})})})});const d=(y=(t=>{switch(t.oldVersion){case 0:t.createObjectStore("history",{keyPath:"id"});case 1:t.createObjectStore("example",{keyPath:"id"})}}),h=e(indexedDB,"open",["history-store",2]),(f=h.request)&&(f.onupgradeneeded=function(t){y&&y(new u(f.result,t.oldVersion,f.transaction))}),h.then(function(t){return new p(t)}));var y,h,f;async function m(t,e){const o=await d,r=await o.transaction(t,e);return{store:r.objectStore(t),complete:r.complete}}function w(t){return m("history",t)}function b(t){return m("example",t)}async function g(t){const e=await d,o=await e.transaction(["history","example"],t);return{history:o.objectStore("history"),example:o.objectStore("example"),complete:o.complete}}function C(t){if(null==t)return null;const e=t.id,o=function(t){const[e,o]=t.split(",",2),r=e.split(":",2)[1].split(";",1)[0],n=atob(o),a=new ArrayBuffer(n.length),i=new Uint8Array(a);for(let t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return new Blob([a],{type:r})}(t.imgSrc);return{timestamp:e,imgSrc:URL.createObjectURL(o),colors:t.colors,name:t.name||new Date(e).toLocaleString()}}const x="#FFFFFF",_="#FFFFFF",S={1:{timestamp:1,imgSrc:"img/demo/andrew-hughes-261571-unsplash.jpg",name:"Photo by Andrew Hughes on Unsplash",colors:{vibrant:{color:"#AE340E",textColor:x},darkVibrant:{color:"#6C140C",textColor:x},lightVibrant:{color:"#DACC9B",textColor:_},muted:{color:"#9F805F",textColor:x},darkMuted:{color:"#3B3945",textColor:x},lightMuted:{color:"#DAD3B0",textColor:_}}},2:{timestamp:2,imgSrc:"img/demo/ever-wild-634729-unsplash.jpg",name:"Photo by ever wild on Unsplash",colors:{vibrant:{color:"#FBA409",textColor:_},darkVibrant:{color:"#7C0404",textColor:x},lightVibrant:{color:"#F9A250",textColor:_},muted:{color:"#AC784C",textColor:x},darkMuted:{color:"#8C6C44",textColor:x},lightMuted:{color:"#BC987A",textColor:_}}},3:{timestamp:3,imgSrc:"img/demo/will-turner-1244879-unsplash.jpg",name:"Photo by Will Turner on Unsplash",colors:{vibrant:{color:"#1E8EE0",textColor:x},darkVibrant:{color:"#061C2C",textColor:x},lightVibrant:{color:"#8AC4EF",textColor:_},muted:{color:"#777C80",textColor:x},darkMuted:{color:"#253D4C",textColor:x},lightMuted:{color:"#BBBCC4",textColor:_}}}};async function A(t){const e=await Promise.all(t.map(async t=>{const e=await function(t){return new Promise((e,o)=>{const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){200===this.status?e(this.response):o(new Error(this.statusText))},r.onerror=function(){o(new Error(this.statusText))},r.send()})}(t.imgSrc),o=await function(t){return new Promise((e,o)=>{const r=new FileReader;r.onload=(()=>e(r.result)),r.onerror=(()=>o(r.error)),r.readAsDataURL(t)})}(e);return function(t){"blob:"===new URL(t).protocol&&URL.revokeObjectURL(t)}(t.imgSrc),{id:t.timestamp,imgSrc:o,colors:t.colors,name:t.name}})),{store:o,complete:r}=await w("readwrite");return e.forEach(t=>o.put(t)),await r,e}async function E(t,e){console.log(t.type,t.payload);try{switch(t.type){case"SAVE":if(t.payload.length>0){const o=await A(t.payload);e({type:"DISPLAY",payload:{entry:C(o[0]),firstLoad:!1,updateHash:!0}}),e({type:"ADD",payload:o.map(C)})}return;case"LOAD":return void await async function(t,e){const{history:o,example:r,complete:n}=await g("readonly");r.iterateCursor(e=>{e&&(e.value.hidden&&t(e.key),e.continue())}),o.iterateCursor(t=>{t&&(e(C(t.value)),t.continue())}),await n}(t=>e({type:"REMOVE",payload:[t]}),t=>e({type:"ADD",payload:[t]}));case"OPEN":let o=null;return Number.isNaN(t.payload.timestamp)||(o=await async function(t){if(t<10){const{store:e}=await b("readonly"),o=await e.get(t);return null!=o&&o.hidden?null:S[t]||null}{const{store:e}=await w("readonly");return C(await e.get(t))}}(t.payload.timestamp)),void e({type:"DISPLAY",payload:{entry:o,firstLoad:t.payload.firstLoad,updateHash:!1}});case"DELETE":if(!Number.isNaN(t.payload.timestamp)&&(await async function(t){if(t<10){const{store:e,complete:o}=await b("readwrite");e.put({id:t,hidden:!0}),await o}else{const{store:e,complete:o}=await w("readwrite");e.delete(t),await o}}(t.payload.timestamp),e({type:"REMOVE",payload:[t.payload.timestamp]}),t.payload.current)){const t=await async function(){const{history:t,example:e}=await g("readonly"),o=await t.getAll(void 0,1);if(o.length>0)return C(o[0]);const r=new Set((await e.getAll()).filter(t=>t.hidden).map(t=>t.id));return Object.values(S).find(t=>!r.has(t.timestamp))||null}();e({type:"DISPLAY",payload:{entry:t,firstLoad:!1,updateHash:!0}})}return}}catch(t){e({type:"ERROR",payload:String(t)})}}self.addEventListener("message",t=>E(t.data,postMessage)),E({type:"LOAD",payload:null},postMessage);
//# sourceMappingURL=db-worker.js.map
